[pytest]
# Markers for categorizing tests
markers =
    unit: mark a test as a unit test
    integration: mark a test as an integration test
    slow: mark a test as slow (takes more than 1 second)
    api: mark a test that tests API endpoints
    music: mark a test that tests music generation
    firebase: mark a test that tests Firebase functionality
    gcp: mark a test that tests GCP functionality

# Default options
addopts = -v --strict-markers --no-header --maxfail=3

# Reduce memory usage
xvs_chunksize = 1  # Run tests in smaller chunks
xvs_numprocesses = 2  # Limit number of parallel processes

# Directories to search for tests
testpaths = tests

# Python files that are considered test modules
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Configure test discovery
norecursedirs = .git .venv venv env build dist

# Configure test output
console_output_style = progress

# Configure test timeouts
timeout = 60  # Reduced timeout to catch hanging tests earlier

# Configure test coverage
[coverage:run]
source = src
omit = 
    */tests/*
    */venv/*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
    if __name__ == .__main__.:
    pass
    raise ImportError